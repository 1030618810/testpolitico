<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test Pol√≠tico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div id="root" class="max-w-4xl mx-auto p-4"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const DOWNLOAD_SECRET = "MiClaveSecreta123";

    // Definiciones anteriores de preguntas pol√≠ticas, opciones y cuadrantes
    const questions = [
      { text:"1. El Estado deber√≠a regular estrictamente los precios de productos b√°sicos.", axis:"economic", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"2. Los impuestos a las grandes empresas deber√≠an ser significativamente m√°s altos.", axis:"economic", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"3. El mercado libre, sin intervenci√≥n estatal, es el mejor sistema econ√≥mico.", axis:"economic", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"4. El Estado deber√≠a ser propietario de industrias estrat√©gicas (energ√≠a, telecomunicaciones).", axis:"economic", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"5. Las regulaciones laborales deber√≠an ser m√≠nimas para fomentar la creaci√≥n de empleo.", axis:"economic", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"6. El Estado debe garantizar un ingreso b√°sico universal.", axis:"economic", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"7. La privatizaci√≥n de servicios p√∫blicos generalmente mejora su eficiencia.", axis:"economic", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"8. Las peque√±as empresas deber√≠an estar exentas de muchas regulaciones gubernamentales.", axis:"economic", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"9. El gobierno deber√≠a limitar la acumulaci√≥n excesiva de riqueza mediante impuestos progresivos.", axis:"economic", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"10. Los tratados de libre comercio son beneficiosos para la econom√≠a nacional.", axis:"economic", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"11. El matrimonio igualitario deber√≠a estar legalmente reconocido.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"12. La legalizaci√≥n controlada de algunas drogas reducir√≠a problemas sociales.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"13. El Estado deber√≠a regular estrictamente el contenido en internet y redes sociales.", axis:"personal", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"14. La eutanasia deber√≠a ser una opci√≥n legal bajo ciertas circunstancias.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"15. Las tradiciones culturales y religiosas deben ser protegidas incluso si limitan libertades individuales.", axis:"personal", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"16. El aborto deber√≠a ser legal y accesible.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"17. El gobierno deber√≠a poder vigilar a los ciudadanos para garantizar la seguridad nacional.", axis:"personal", weights:{A:0,B:1,C:2,D:3,E:4} },
      { text:"18. La libertad de expresi√≥n debe protegerse incluso cuando las opiniones son controvertidas.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"19. Las pol√≠ticas de acci√≥n afirmativa son necesarias para corregir desigualdades hist√≥ricas.", axis:"personal", weights:{A:4,B:3,C:2,D:1,E:0} },
      { text:"20. El servicio militar obligatorio es necesario para la defensa nacional.", axis:"personal", weights:{A:0,B:1,C:2,D:3,E:4} }
    ];

    const options = [
      { code:"A", label:"A. Totalmente de acuerdo" },
      { code:"B", label:"B. De acuerdo" },
      { code:"C", label:"C. Neutral" },
      { code:"D", label:"D. En desacuerdo" },
      { code:"E", label:"E. Totalmente en desacuerdo" }
    ];

    const quadrants = {
      "1":{ title:"TOTALITARISMO",   range:"LE:0‚Äì20, LP:0‚Äì20",  perfil:"Prefiere un gobierno fuerte que controle tanto la econom√≠a como aspectos sociales." },
      "2":{ title:"CONSERVADURISMO", range:"LE:21‚Äì40, LP:0‚Äì20", perfil:"Apoya la libertad econ√≥mica pero favorece control social y valores tradicionales." },
      "3":{ title:"PROGRESISMO",     range:"LE:0‚Äì20, LP:21‚Äì40", perfil:"Defiende libertades sociales pero apoya intervenci√≥n estatal en econom√≠a." },
      "4":{ title:"LIBERALISMO",     range:"LE:21‚Äì40, LP:21‚Äì40", perfil:"Defiende tanto libertades econ√≥micas como personales." }
    };

    function PoliticalTest() {
      const [step, setStep] = useState("info");
      const [user, setUser] = useState({});
      const [answers, setAns] = useState(Array(questions.length).fill(null));
      const chartRef = useRef(null);
      const chartInstance = useRef(null);

      const handleAns = (i, code) => {
        const a = [...answers]; a[i] = code; setAns(a);
      };

      const calcScores = () => {
        let eco=0, per=0;
        answers.forEach((sel,i)=>{
          if(!sel) return;
          const w=questions[i].weights[sel];
          questions[i].axis==="economic" ? eco+=w : per+=w;
        });
        return { economic: eco, personal: per };
      };

      const getQuad = (e,p) => {
        if(e<=20 && p<=20) return "1";
        if(e>=21 && p<=20) return "2";
        if(e<=20 && p>=21) return "3";
        return "4";
      };

      useEffect(()=>{
        if(step!="results") return;
        const { economic, personal } = calcScores();
        const ctx = chartRef.current.getContext('2d');
        if(chartInstance.current) chartInstance.current.destroy();
        chartInstance.current = new Chart(ctx, {
          type:'radar',
          data:{
            labels:['Liberalismo','Conservadurismo','Totalitarismo','Progresismo'],
            datasets:[{
              label:'Tu cuadrante',
              data:[
                (economic>20&&personal>20)?100:0,
                (economic>20&&personal<=20)?100:0,
                (economic<=20&&personal<=20)?100:0,
                (economic<=20&&personal>20)?100:0
              ],
              backgroundColor:'rgba(54,162,235,0.2)',
              borderColor:'rgba(54,162,235,1)',
              pointBackgroundColor:'#1e40af', pointRadius:6
            }]
          },
          options:{
            scales:{ r:{ angleLines:{display:true}, suggestedMin:0, suggestedMax:100, ticks:{display:false}, pointLabels:{font:{size:14}} } },
            plugins:{ legend:{display:false}, tooltip:{enabled:false} },
            responsive:true, maintainAspectRatio:false
          }
        });
      },[step, answers]);

      const saveTest = () => {
        const { economic, personal } = calcScores();
        const quad = getQuad(economic, personal);
        const record = { timestamp: new Date().toISOString(), ...user, quadrant: quadrants[quad].title, economic, personal };
        questions.forEach((q,i)=>{
          const sel = answers[i] || '';
          record[`Q${i+1}`] = sel;
          record[`P${i+1}`] = sel ? q.weights[sel] : 0;
        });
        let all = [];
        try { all = JSON.parse(localStorage.getItem('politicalTest')) || []; } catch{ all = []; }
        all.push(record);
        localStorage.setItem('politicalTest', JSON.stringify(all));
      };

      const downloadAllCSV = () => {
        const pass = prompt('Clave CSV:'); if(pass!==DOWNLOAD_SECRET) return alert('Acceso denegado');
        let all = [];
        try { all = JSON.parse(localStorage.getItem('politicalTest')) || []; } catch{};
        if(!all.length) return alert('Sin datos');
        const headerKeys = Object.keys(all[0]);
        const rows = all.map(r => headerKeys.map(k=>`"${String(r[k]||'').replace(/"/g,'""')}"`).join(','));
        const bom = '\uFEFF';
        const csv = bom + [headerKeys.join(','), ...rows].join('\n');
        const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='consolidado.csv'; a.click(); URL.revokeObjectURL(url);
      };

      const clearAllData = () => {
        const pass = prompt('Clave limpiar:'); if(pass!==DOWNLOAD_SECRET) return alert('Acceso denegado');
        if(confirm('¬øBorrar todo?')){ localStorage.removeItem('politicalTest'); window.location.reload(); }
      };

      const exportPDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const { economic, personal } = calcScores();
        const quad = getQuad(economic, personal);
        const info = quadrants[quad];
        doc.setFontSize(16).text('Resultados del Test Pol√≠tico', 20, 20);
        doc.setFontSize(14).text(`${info.title} (${info.range})`, 20, 30);
        doc.setFontSize(12);
        const lines = doc.splitTextToSize(info.perfil, 170);
        doc.text(lines, 20, 40);
        let y = 60;
        questions.forEach((q,i)=>{
          if(y>260){ doc.addPage(); y=20; }
          const sel = answers[i]||'';
          const label = sel ? options.find(o=>o.code===sel).label : 'Sin respuesta';
          const pts = sel ? q.weights[sel] : 0;
          const text = `${i+1}. ${label} (Pts: ${pts})`;
          const txtLines = doc.splitTextToSize(text, 170);
          doc.text(txtLines, 20, y);
          y += txtLines.length * 6;
        });
        doc.addPage();
        doc.text('Gr√°fico Radar', 20, 20);
        const img = chartRef.current.toDataURL('image/png');
        doc.addImage(img, 'PNG', 20, 30, 170, 100);
        doc.save('resultado_test_politico.pdf');
      };

      // VISTAS
      if(step === 'info'){
        return (
          <div className="bg-white p-6 rounded shadow">
            <h2 className="text-2xl font-bold mb-4">¬øD√≥nde est√°s t√∫ en el espectro pol√≠tico?</h2>
	    <h2 className="text-2xl font-bold mb-4">¬°Desc√∫brelo con este test r√°pido y an√≥nimo!</h2>
En tiempos donde la pol√≠tica parece dividirnos, entender nuestras ideas puede acercarnos. Este test te ayudar√° a ubicarte en el espectro pol√≠tico de una forma distinta: m√°s all√° de ‚Äúizquierda‚Äù o ‚Äúderecha‚Äù, explorando tambi√©n tus opiniones sobre libertades personales, el rol del Estado, la econom√≠a y la justicia social.<br /><br />

Adem√°s, con unas breves preguntas demogr√°ficas, podr√°s ver c√≥mo personas de distintos lugares, edades y realidades piensan como t√∫... o no.<br /><br />

üïê Duraci√≥n estimada: 5 minutos<br /><br />
üîí Tu informaci√≥n es confidencial y no se usar√° con fines comerciales.<br /><br />

¬°An√≠mate a responder y comp√°rtelo con tus amigos! Cuantas m√°s voces tengamos, m√°s rica ser√° la conversaci√≥n democr√°tica.<br /><br />


            {[
              { text:'1. ¬øCu√°l es tu rango de edad?', key:'edad', options:["<18","18-24","25-34","35-44","45-54","55-64","65+"], labels:['Menos de 18','18-24','25-34','35-44','45-54','55-64','65+'] },
              { text:'2. ¬øCon cu√°l te identificas en g√©nero?', key:'sexo', options:['Mujer','Hombre','No binaria','Prefiero no decirlo','Otro'], labels:['Mujer','Hombre','Persona no binaria','Prefiero no decirlo','Otro'] },
              { text:'3. ¬øEn qu√© ciudad vives?', key:'ciudad', options:['Bogot√°','Medell√≠n','Cali','Barranquilla','Otra'], labels:['Bogot√°','Medell√≠n','Cali','Barranquilla','Otra'] },
              { text:'4. Si vives en Bogot√°, ¬øen qu√© localidad?', key:'localidad', options:['Antonio Nari√±o','Barrios Unidos','Bosa','Candelaria','Chapinero','Ciudad Bol√≠var','Engativ√°','Fontib√≥n','Kennedy','Los M√°rtires','Puente Aranda','Rafael Uribe Uribe','San Crist√≥bal','Santa Fe','Suba','Sumapaz','Teusaquillo','Tunjuelito','Usaqu√©n','Usme','No vivo en Bogot√°'], labels:[] },
              { text:'5. ¬øCu√°l es tu estrato?', key:'estrato', options:['1','2','3','4','5','6','No s√©'], labels:['Estrato 1','Estrato 2','Estrato 3','Estrato 4','Estrato 5','Estrato 6','No s√© / Prefiero no responder'] },
              { text:'6. ¬øVives en una vivienda...?', key:'vivienda', options:['Propia','Familiar','Alquilada','Subsidio','Informal','Otro'], labels:['Propia','Familiar','Alquilada','En arriendo con subsidio','En arriendo informal','Otro'] },
              { text:'7. ¬øAfiliaci√≥n EPS?', key:'eps', options:['S√≠','No','No s√©'], labels:['S√≠','No','No s√© / Prefiero no responder'] },
              { text:'8. R√©gimen EPS', key:'regimen', options:['Subsidiado','Contributivo','No s√©'], labels:['Subsidiado','Contributivo','No s√© / Prefiero no responder'] },
              { text:'9. Nivel educativo m√°s alto', key:'educacion', options:['Primaria','Secundaria','Tecnica','Universitaria','Posgrado','No s√©'], labels:['Primaria','Secundaria','T√©cnica/tecnol√≥gica','Universitaria','Posgrado/especializaci√≥n','Prefiero no responder'] },
              { text:'10. Ocupaci√≥n actual', key:'ocupacion', options:['Estudiante','Publico','Privado','Independiente','Desempleado','Hogar','Jubilado','Otro'], labels:['Estudiante','Empleado/a p√∫blico','Empleado/a privado','Independiente/emprendedor','Desempleado','Hogar/cuidados','Pensionado/jubilado','Otro'] }
            ].map((q,i)=>(
              <label key={i} className="block mb-4">
                <span className="font-semibold text-gray-800">{q.text}</span>
                <select
                  className="mt-1 block w-full border rounded p-2 bg-white"
                  value={user[q.key]||''}
                  onChange={e=>setUser({...user,[q.key]:e.target.value})}
                >
                  <option value="">Selecciona...</option>
                  {q.options.map((opt,j)=>(
                    <option key={opt} value={opt}>{q.labels[j]||opt}</option>
                  ))}
                </select>
              </label>
            ))}
            <div className="flex gap-4">
<button
  disabled={!['edad','sexo','ciudad','localidad','estrato','vivienda','eps','regimen','educacion','ocupacion']
    .every(k => user[k])}
  className="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50"
  onClick={()=>setStep('questions')}
>
  Comenzar Test
</button>
              <button onClick={downloadAllCSV} className="bg-indigo-600 text-white px-4 py-2 rounded">Descargar Consolidado</button>
              <button onClick={clearAllData} className="bg-red-600 text-white px-4 py-2 rounded">Limpiar Datos</button>
            </div>
          </div>
        );
      }

      if(step==='questions'){
        return (
          <div className="bg-white p-6 rounded-lg shadow-lg">
            <h2 className="text-2xl font-bold mb-4">Preguntas Pol√≠ticas</h2>
            <progress value={answers.filter(a=>a).length} max={questions.length} className="w-full h-2 mb-6 rounded"/>
            {questions.map((q,i)=>(
              <div key={i} className="border p-4 mb-4 rounded-md hover:shadow">
                <p className="font-medium mb-2">{q.text}</p>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  {options.map(o=>(
                    <label key={o.code} className="inline-flex items-center space-x-2">
                      <input type="radio" className="form-radio h-5 w-5 text-blue-600" checked={answers[i]===o.code} onChange={()=>handleAns(i,o.code)}/>
                      <span>{o.label}</span>
                    </label>
                  ))}
                </div>
              </div>
            ))}
            <div className="flex justify-end">
              <button disabled={answers.filter(a=>a).length<questions.length} onClick={()=>{saveTest(); setStep('results');}} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50">Ver Resultados</button>
            </div>
          </div>
        );
      }

      const { economic, personal } = calcScores();
      const quad = getQuad(economic, personal);
      const info = quadrants[quad];
      return (
        <div className="bg-white p-6 rounded shadow">
          <h2 className="text-2xl font-bold mb-4">Tus Resultados</h2>
          <div className="w-full" style={{height:'400px'}}><canvas ref={chartRef}/></div>
          <h3 className="text-xl font-semibold mt-4">{info.title} ({info.range})</h3>
          <p className="italic mb-4">{info.perfil}</p>
          <p className="text-sm text-gray-600 mb-4">Puntaje Econ√≥mico: {economic} / 40  ‚Ä¢  Puntaje Personal: {personal} / 40</p>
          <div className="flex gap-4">
            <button onClick={exportPDF} className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Exportar en PDF</button>
            <button onClick={downloadAllCSV} className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Descargar Consolidado</button>
            <button onClick={clearAllData} className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Limpiar Datos</button>
            <button onClick={()=>window.location.reload()} className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Reiniciar</button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<PoliticalTest />);
  </script>
</body>
</html>
